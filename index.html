<!DOCTYPE html>
<html lang="id">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>Formulir Submit Soal PSAS</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f5;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      background: #fff;
      margin: auto;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    h3 { text-align: center; color: #004d99; }
    label { display: block; margin-top: 15px; font-weight: 600; }
    input, select {
      width: 100%; padding: 10px; border-radius: 8px;
      border: 1px solid #ccc; margin-top: 5px;
    }
    button {
      width: 100%; margin-top: 20px; padding: 12px;
      border: none; border-radius: 8px;
      background: #28a745; color: white; font-weight: bold;
      cursor: pointer;
    }
    .message {
      margin-top: 20px; padding: 12px; border-radius: 8px;
      font-weight: 600; text-align: center; display: none;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>
  <div class="container">
    <h3>Formulir Submit Soal PSAS</h3>
    <form id="submissionForm">
      <label>Nama Guru:</label>
      <input type="text" name="namaGuru" required>

      <label>Kelas:</label>
      <select name="kelas" required>
        <option value="">Pilih Kelas</option>
        <option>X DKV 1</option><option>X DKV 2</option>
        <option>XI DKV 1</option><option>XI DKV 2</option>
        <option>XI DKV 3</option><option>X APHP</option>
        <option>XI APHP</option><option>XII DKV 1</option>
        <option>XII APHP</option>
      </select>

      <label>Mata Pelajaran:</label>
      <input type="text" name="mataPelajaran" required>

      <label>Link Dokumen Soal (Share Viewer):</label>
      <input type="url" name="linkMateri" required>

      <label>Unggah File Kisi-kisi:</label>
      <input type="file" id="uploadedFile" name="uploadedFile" required>

      <button type="submit">Kirim Dokumen Soal PSAS</button>
    </form>

    <div id="responseMessage" class="message"></div>
  </div>

  <script>
    function showMessage(type, text) {
      const msg = document.getElementById('responseMessage');
      msg.className = 'message ' + type;
      msg.style.display = 'block';
      msg.textContent = text;
    }

    document.getElementById('submissionForm').addEventListener('submit', e => {
      e.preventDefault();
      const file = document.getElementById('uploadedFile').files[0];
      if (!file) return showMessage('error', 'File Kisi-kisi wajib diunggah.');

      const reader = new FileReader();
      reader.onload = function(evt) {
        const formData = {
          namaGuru: e.target.namaGuru.value,
          kelas: e.target.kelas.value,
          mataPelajaran: e.target.mataPelajaran.value,
          linkMateri: e.target.linkMateri.value,
          fileName: file.name,
          fileData: evt.target.result.split(',')[1]
        };

        showMessage('', '⏳ Mengirim data...');
        google.script.run
          .withSuccessHandler(res => showMessage('success', '✅ ' + res))
          .withFailureHandler(err => showMessage('error', '❌ ' + err.message))
          .uploadData(formData);
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
